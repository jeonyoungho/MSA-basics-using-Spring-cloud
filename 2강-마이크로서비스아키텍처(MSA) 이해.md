# 2강-마이크로서비스아키텍처(MSA) 이해

## MSA를 알아보기 전에
- MSA란 시스템을 여러 개의 독립된 서비스로 나눠서, 이 서비스를 조합함으로서 기능을 제공하는 아키텍쳐 디자인 패턴
- MSA를 통해 독립된 서비스란 특정 서비스에서 다른 서비스에 대해 모르고 각 팀은 자체적으로 배포만 하면 됨
- 넷플릭스, 트위터, 아마존 등과 같은 기업들은 MSA를 적용하여 500개가 넘는 서비스를 가지고 있음(MSA를 첫 도입한 기업들)

### 아마존의 선택 - 2002년경 제프 베조스(아마존 대표)가 보낸 메일
- 1)2002년 전 직원한테 모든 팀들은 데이터 기능들을 서비스 인터페이스로 연결시켜라.
- 2)팀들은 이 인터페이스를 통해서만 연락해야 한다.
- 3)다른 어떤 커뮤니케이션 방법도 허용되지 않는다. 직접 링크를 보내거나 다른 팀의 스토리지에 직접 접근해서도 안 되며, 공유 메모리나 백도어 같은 것도 안된다. 모든 커뮤니케이션은 네트워크를 통한 서비스 인터페이스로 이루어져야 한다.
- 4)어떤 기술을 쓰든 상관없다. HTTP, Cobra, Pubsub, 독자 프로토콜... 그건 상관없다. 베조스는 그런데 관심 없다.
- 5)모든 서비스 인터페이스는 예외 ㅇ벗이 외부에서 이용 가능하게 만들어져야 한다. 그 말은 팀들은 외부 개발자들이 인터페이스를 이용할 수 있게 해야한다는 것이다. 예외는 없다.
- 6)이를 실천하지 않는 살마은 누구든 해고될 것이다.

### 넷플릭스의 선택
- 2008년 DB에 심각한 문제가 발생해 고객에게 DVD를 보낼 수 없는 사태 발생
    - scale-up확장만 가능한 인프라 구조와 단일 장애 지점(SPOF)이라는 한계에서 벗어나길 선언
    - 그 시작은 아파치 카산드라라는 데이터베이스
- 2009년 AWS로 이관 시작
    - 세 가지 목표에 집중(확장성(Scalability), 성능(Performance), 가용성(Availability))
~~~
'자체 보유 인프라와 솔루션으로는 이렇게 급증한 트래픽을 감당할 수 있는 확장성을 확보할 수 없었을 것' - 유리 이즈라일레프스키(Netfilx 클라우드 및 플랫폼 엔지니어링 부문 부사장)
~~~

## MSA란
- 공식적인 정의는 없지만 아래와 같은 공감대가 존재함
    - 각 서비스간 Network를 통해, 보통 HTTP를 통신
    - 독립된 배포 단위
    - 각 서비스는 쉽게 교체 가능
    - 각 서비스는 기능 중심으로 구성됨 (프론트 엔드, 추천, 정산, 상품 등)
    - 각 서비스에 적합한 프로그래밍 언어, 데이터베이스, 환경으로 만들어짐
    - 서비스는 크기가 작고, 상황에 따라 경계를 정하고, 자율적으로 개발되고, 독립적으로 배포되고, 분산되고, 자동화된 프로세스로 구축되고 배포된다.

- 마이크로서비스는 한 팀에 의해 개발할 수 있는 크기가 상한선이다. 절대로 3~9명의 사람들이 스스로 더 많은 개발을 할 수 없을 정도로 커지면 안된다.
~~~
'마이크로서비스는 아직까지 아이디어 수준에서 크게 벗어나 있지 않다. 다양한 산업 분야에서 폭넓게 적용되고 있지만 그것이 좋은지 나쁜지는 시간이 더 지나봐야 알 수 있다' - 조쉬롱, 케니 바스타니, 피보탈
~~~

<img width="528" alt="스크린샷 2021-04-14 오후 6 23 44" src="https://user-images.githubusercontent.com/44339530/114687267-8cca2500-9d4e-11eb-8b08-a6122f539af7.png"><br>

## 모놀리틱 서비스의 MSA로 변환
<img width="625" alt="스크린샷 2021-04-14 오후 6 26 19" src="https://user-images.githubusercontent.com/44339530/114687620-e92d4480-9d4e-11eb-9b08-f03ca8f19574.png"><br>

- 일단 공통 레포지토리인 Share.jar를 없앰
- 각 서비스별로 DB를 갖고 DB는 각 팀이 관리함
- Order팀에서 Product팀의 API를 호출하여 사용한다. 

## MSA 실습
- workspace참고
- RestTemplate을 활용하여 다른 서비스로 부터 HTTP통신을 통해 데이터를 받아옴
- 마이크로서비스 아키텍처에서는 도메인의 중복을 어느 정도 허용함
- 대신 API 스펙이 견고하게 됨, 한 MSA에서 다른 MSA를 호출할 때의 이슈사항을 각 팀들간의 커뮤니케이션을 통해 주고받음(API문서 관리가 중요함!)
